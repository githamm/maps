<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="robots" content="noindex,follow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Denver Public Schools Enrollment Map | The Denver Post</title>
    <link rel="icon" href="https://www.denverpost.com/wp-content/uploads/2016/05/cropped-DP_bug_denverpost.jpg?w=32" sizes="32x32" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <!-- <link rel="stylesheet" type="text/css" href="css/vanilla-tabs.min.css" /> -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin="" />
    <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <script src="https://extras.denverpost.com/foundation/js/vendor/modernizr.js"></script>
    <!-- <script src="./js/vanilla-tabs.min.js"></script> -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.3/moment-with-locales.min.js" integrity="sha512-vFABRuf5oGUaztndx4KoAEUVQnOvAIFs59y4tO0DILGWhQiFnFHiR+ZJfxLDyJlXgeut9Z07Svuvm+1Jv89w5g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="denver_population_merge.json"></script>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Arimo&display=swap');

    body {
        font-family: 'Arimo', sans-serif;
    }

    #map {
        height: 500px;
        width: 100%;
        border: 2px solid silver;
    }

    fieldset {
        border: 1px solid silver;
        margin-bottom: 12px;
    }

    .leaflet-control {
        display: contents;
    }

    .leaflet-popup-content-wrapper {
        border-radius: 0;
    }

    .leaflet-popup-content {
        width: 165px;
        max-width: 165px;
    }

    .school-name {
        font-size: 1.1em;
        font-weight: bold;
        text-transform: uppercase;
        line-height: 1.1;
        color: brown;
        margin-bottom: 5px !important;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    tr {
        border-bottom: 1px solid silver;
    }

    table,
    th,
    td {
        text-align: center;
    }

    .green,
    .red {
        height: 12px;
        width: 12px;
        display: inline-block;
        margin-right: 5px;
    }

    .green {
        background: green;
        margin-top: 5px;
    }

    .red {
        background: red;
    }

    .black {
        color: #000;
        font-weight: bold;
        margin-right: 5px;

    }

    .source {
        font-size: .9em;
        font-style: italic;
    }
    </style>
</head>

<body>
    <!-- <h2>Enrollment in Denver schools falls after years of expansion</h2>
    <p>Denver Public Schools experienced years of rapid growth that began in 2008, enrolling thousands more students and opening new schools. But by 2017, DPS leaders were projecting enrollment to decline by 2020 &mdash; a prediction that came true as falling birth rates and neighborhood gentrification altered the cityâ€™s demographics.</p> -->
    <fieldset>
        <p>Click below to show/hide layers, click map for details.</p>
        <div id="controls-panel" class="leaflet-control-layers-expanded"></div>
        <div><span class="green"></span><span class="legend text">Enrollment increase</span></div>
        <div><span class="red"></span><span class="legend-text">Enrollment decrease</span></div>
        <div><span class="black">&mdash;</span><span class="legend-text">Neighborhood boundary</span></div>
    </fieldset>
    <div id="map"></div>
    <p class="source">Sources: Colorado Department of Education, Denver Public Schools / Kevin Hamm, The Denver Post</p>
    <script>
    $(document).ready(function() {
        /* Adapted from http://bl.ocks.org/zross/47760925fcb1643b4225 */
        var mapTiles = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 19
        });
        var blankMap = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 19
        });

        var map = L.map('map', {
            // center: [39.742043, -104.901531],
            zoom: 11,
            minZoom: 11,
            //dragging: false,
            layers: [mapTiles],
            scrollWheelZoom: true,
            preferCanvas: true
        });

        $.getJSON("denver-population_merge.json", function(data) {
        L.geoJson(data, {

        function onEachFeature(feature, layer) {

            var popupContent = '<h3 class="popup-header">' + feature.properties.PCT_LESS_18_2010 + '</h3>';

            if (feature.properties && feature.properties.popupContent) {
                popupContent += feature.properties.popupContent;
            }

            layer.bindPopup(popupContent);
        }

        function style(feature) {
            return {
                weight: 1,
                opacity: 1,
                color: '#000',
                //dashArray: '1',
                fillOpacity: 0,
                fillColor: ''
            };
        }

        // get color depending on population density value
    function getColor(d) {
        return d > 1000 ? '#800026' :
            d > 500  ? '#BD0026' :
            d > 200  ? '#E31A1C' :
            d > 100  ? '#FC4E2A' :
            d > 50   ? '#FD8D3C' :
            d > 20   ? '#FEB24C' :
            d > 10   ? '#FED976' : '#FFEDA0';
    }

    function style(feature) {
        return {
            weight: 2,
            opacity: 1,
            color: 'white',
            dashArray: '3',
            fillOpacity: 0.7,
            fillColor: getColor(feature.properties.PCT_LESS_18_2010)
        };
    }

    /* global statesData */
    const geojson = L.geoJson(data, {
        style,
    }).addTo(map);

})
    })
            // style: function(feature) {
            //     return feature.properties && feature.properties.style;
            // },

            // onEachFeature: onEachFeature,
            // style: style
        //}).addTo(map);
        //map.fitBounds(perimeterLayer.getBounds());

        var promise = $.getJSON('school_data.json');

        promise.then(function(data) {
            var enrollment2010Layer = L.geoJson(data, {
                pointToLayer: function(feature, latlng) {
                    var enrollment = feature.properties.enrollment_2010;
                    var circleRadius;
                    var circleSize = Math.sqrt(enrollment) * .5;
                    var activeCircle = {
                        radius: circleSize,
                        fillColor: "#6e6e6e",
                        color: "#000",
                        weight: 1,
                        opacity: 1,
                        fillOpacity: .5
                    };
                    var enrollment2010;
                    if (feature.properties.enrollment_2010 === null) {
                        enrollment2010 = 'n/a'
                    } else enrollment2010 = feature.properties.enrollment_2010;
                    var enrollmentChange2015;
                    if (feature.properties.enrollment_2010 === null) {
                        enrollmentChange2015 = ''
                    } else enrollmentChange2015 = Math.round(((feature.properties.enrollment_2015 - feature.properties.enrollment_2010) / feature.properties.enrollment_2010) * 100) + '%';
                    var enrollmentChange2020 = Math.round(((feature.properties.enrollment_2020 - feature.properties.enrollment_2015) / feature.properties.enrollment_2015) * 100) + '%';


                    var popupInfo = '<p class="school-name">' + feature.properties.school_name + '</p><table><thead><tr><th>Year</th><th>Enrollment</th><th>Change</th></tr></thead><tbody><tr><td>2010</td><td>' + enrollment2010 + '</td><td></td></tr><tr><td>2015</td><td>' + feature.properties.enrollment_2015 + '</td><td>' + enrollmentChange2015 + '</td></tr><tr><td>2020</td><td>' + feature.properties.enrollment_2020 + '</td><td>' + enrollmentChange2020 + '</td></tr></tbody></table>';

                    return L.circleMarker(latlng, activeCircle).bindPopup(popupInfo).openPopup();
                }
            });
            var enrollment2015Layer = L.geoJson(data, {
                pointToLayer: function(feature, latlng) {
                    var enrollment = feature.properties.enrollment_2015;
                    var circleRadius;
                    var circleSize = Math.sqrt(enrollment) * .5;
                    var circleColor;
                    if (feature.properties.enrollment_2015 > feature.properties.enrollment_2010) {
                        circleColor = 'green'
                    } else circleColor = 'red'
                    var activeCircle = {
                        radius: circleSize,
                        fillColor: circleColor,
                        color: circleColor,
                        weight: 1,
                        opacity: 1,
                        fillOpacity: .5
                    };

                    var enrollment2010;
                    if (feature.properties.enrollment_2010 === null) {
                        enrollment2010 = 'n/a'
                    } else enrollment2010 = feature.properties.enrollment_2010;
                    var enrollmentChange2015;
                    if (feature.properties.enrollment_2010 === null) {
                        enrollmentChange2015 = ''
                    } else enrollmentChange2015 = Math.round(((feature.properties.enrollment_2015 - feature.properties.enrollment_2010) / feature.properties.enrollment_2010) * 100) + '%';
                    var enrollmentChange2020 = Math.round(((feature.properties.enrollment_2020 - feature.properties.enrollment_2015) / feature.properties.enrollment_2015) * 100) + '%';


                    var popupInfo = '<p class="school-name">' + feature.properties.school_name + '</p><table><thead><tr><th>Year</th><th>Enrollment</th><th>Change</th></tr></thead><tbody><tr><td>2010</td><td>' + enrollment2010 + '</td><td></td></tr><tr><td>2015</td><td>' + feature.properties.enrollment_2015 + '</td><td>' + enrollmentChange2015 + '</td></tr><tr><td>2020</td><td>' + feature.properties.enrollment_2020 + '</td><td>' + enrollmentChange2020 + '</td></tr></tbody></table>';

                    return L.circleMarker(latlng, activeCircle).bindPopup(popupInfo).openPopup();
                }
            });
            var enrollment2020Layer = L.geoJson(data, {
                pointToLayer: function(feature, latlng) {
                    var enrollment = feature.properties.enrollment_2020;
                    var circleRadius;
                    var circleSize = Math.sqrt(enrollment) * .5;
                    var circleColor;
                    if (feature.properties.enrollment_2020 > feature.properties.enrollment_2015) {
                        circleColor = 'green'
                    } else circleColor = 'red'
                    var activeCircle = {
                        radius: circleSize,
                        fillColor: circleColor,
                        color: circleColor,
                        weight: 1,
                        opacity: 1,
                        fillOpacity: .5
                    };

                    var enrollment2010;
                    if (feature.properties.enrollment_2010 === null) {
                        enrollment2010 = 'n/a'
                    } else enrollment2010 = feature.properties.enrollment_2010;
                    var enrollmentChange2015;
                    if (feature.properties.enrollment_2010 === null) {
                        enrollmentChange2015 = ''
                    } else enrollmentChange2015 = Math.round(((feature.properties.enrollment_2015 - feature.properties.enrollment_2010) / feature.properties.enrollment_2010) * 100) + '%';
                    var enrollmentChange2020 = Math.round(((feature.properties.enrollment_2020 - feature.properties.enrollment_2015) / feature.properties.enrollment_2015) * 100) + '%';


                    var popupInfo = '<p class="school-name">' + feature.properties.school_name + '</p><table><thead><tr><th>Year</th><th>Enrollment</th><th>Change</th></tr></thead><tbody><tr><td>2010</td><td>' + enrollment2010 + '</td><td></td></tr><tr><td>2015</td><td>' + feature.properties.enrollment_2015 + '</td><td>' + enrollmentChange2015 + '</td></tr><tr><td>2020</td><td>' + feature.properties.enrollment_2020 + '</td><td>' + enrollmentChange2020 + '</td></tr></tbody></table>';

                    return L.circleMarker(latlng, activeCircle).bindPopup(popupInfo).openPopup();
                }
            });
            var enrollmentChangeLayer = L.geoJson(data, {
                pointToLayer: function(feature, latlng) {
                    var enrollmentChangeAbsolute = Math.abs((feature.properties.enrollment_2020 - feature.properties.enrollment_2015) / feature.properties.enrollment_2015);
                    var circleRadius;
                    var circleSize = Math.sqrt(enrollmentChangeAbsolute) * 15;
                    var enrollmentChange = (feature.properties.enrollment_2020 - feature.properties.enrollment_2015) / feature.properties.enrollment_2015;
                    var circleColor;
                    var strokeColor;
                    var strokeWeight;
                    if (enrollmentChange < 0) {
                        circleColor = 'red'
                    } else if (enrollmentChange > 0) {
                        circleColor = 'green'
                    } else circleColor = 'gray';
                    if (feature.properties.enrollment_2010 === null) {
                        strokeColor = 'black'
                    } else strokeColor = circleColor;
                    if (feature.properties.enrollment_2010 === null) {
                        strokeWeight = 2
                    } else strokeWeight = 0;
                    var activeCircle = {
                        radius: circleSize,
                        fillColor: circleColor,
                        color: strokeColor,
                        weight: strokeWeight,
                        opacity: 1,
                        fillOpacity: .5
                    };

                    var enrollment2010;
                    if (feature.properties.enrollment_2010 === null) {
                        enrollment2010 = 'n/a'
                    } else enrollment2010 = feature.properties.enrollment_2010;
                    var enrollmentChange2015;
                    if (feature.properties.enrollment_2010 === null) {
                        enrollmentChange2015 = ''
                    } else enrollmentChange2015 = Math.round(((feature.properties.enrollment_2015 - feature.properties.enrollment_2010) / feature.properties.enrollment_2010) * 100) + '%';
                    var enrollmentChange2020 = Math.round(((feature.properties.enrollment_2020 - feature.properties.enrollment_2015) / feature.properties.enrollment_2015) * 100) + '%';


                    var popupInfo = '<p class="school-name">' + feature.properties.school_name + '</p><table><thead><tr><th>Year</th><th>Enrollment</th><th>Change</th></tr></thead><tbody><tr><td>2010</td><td>' + enrollment2010 + '</td><td></td></tr><tr><td>2015</td><td>' + feature.properties.enrollment_2015 + '</td><td>' + enrollmentChange2015 + '</td></tr><tr><td>2020</td><td>' + feature.properties.enrollment_2020 + '</td><td>' + enrollmentChange2020 + '</td></tr></tbody></table>';

                    return L.circleMarker(latlng, activeCircle).bindPopup(popupInfo).openPopup();
                }
            });

            map.fitBounds(enrollmentChangeLayer.getBounds(), {
                padding: [50, 50]
            });

            //var enrollmentLayers = L.layerGroup([enrollment2010, enrollment2015, enrollment2020]);

            var baseMaps = {
                "Enrollment change 2015-20": enrollmentChangeLayer,
                "Hide enrollment change": blankMap

            };

            var overlayMaps = {
                //"Enrollment change": enrollmentChange,
                "2010 enrollment": enrollment2010Layer,
                "2015 enrollment": enrollment2015Layer,
                "2020 enrollment": enrollment2020Layer
            };

            //var layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);

            // Create the control and add it to the map;
            var control = L.control.layers(baseMaps, overlayMaps);
            control.addTo(map);

            // Call the getContainer routine.
            var htmlObject = control.getContainer();
            // Get the desired parent node.
            var a = document.getElementById('controls-panel');

            // Finally append that node to the new parent.
            function setParent(el, newParent) {
                newParent.appendChild(el);
            }
            setParent(htmlObject, a);

            enrollmentChangeLayer.addTo(map);

            //enrollmentChange.addTo(map);

            // $("#enrollment-2010").click(function() {
            //     map.addLayer(enrollment2010)
            //     map.removeLayer(enrollment2015)
            //     map.removeLayer(enrollment2020)
            //     map.removeLayer(enrollmentChange)
            // });
            // $("#enrollment-2015").click(function() {
            //     map.removeLayer(enrollment2010)
            //     map.addLayer(enrollment2015)
            //     map.removeLayer(enrollment2020)
            //     map.removeLayer(enrollmentChange)
            // });
            // $("#enrollment-2020").click(function() {
            //     map.removeLayer(enrollment2010)
            //     map.removeLayer(enrollment2015)
            //     map.addLayer(enrollment2020)
            //     map.removeLayer(enrollmentChange)
            // });
            // $("#enrollment-change").click(function() {
            //     map.removeLayer(enrollment2010)
            //     map.removeLayer(enrollment2015)
            //     map.removeLayer(enrollment2020)
            //     map.addLayer(enrollmentChange)
            // });

        })
    })
    </script>
</body>

</html>