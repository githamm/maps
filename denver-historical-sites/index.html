<!DOCTYPE html>
<html>

<head>
    <title>Denver Undesignated Cultural/Historical Sites</title>
    <meta charset="utf-8">
    <meta name="robots" content="noindex,follow">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/dataTables.foundation.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.1/css/responsive.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.1/css/responsive.foundation.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/foundation/6.2.4/foundation.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/dataTables.foundation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/foundation/6.2.4/foundation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/yadcf/0.9.2/jquery.dataTables.yadcf.js"></script>
    <style>
    #wrapper {
        margin: 0 auto;
        width: 100%;
    }

    #panel {
        /*float: left;*/
        width: 100%;
        height: 50px;
        /*background-color: #175B81;
        color: white;*/
    }

    #map {
        width: 100%;
        height: 600px;
        border: 2px solid silver;
    }

    .map-icon {
        font-size: 36px;
    }

    .category {
        font-size: 1.8em;
        color: brown;
        line-height: 1.2;
        border-bottom: 3px solid brown;
        margin-bottom: -5px !important;
    }

    .site {
        font-size: 1.2em;
        line-height: 1.2;
        font-weight: bold;
        margin-bottom: -18px !important;
    }

    .address {
        font-size: 1.2em;
        font-style: italic;
    }

    .legend {
        font-size: .9em;
        margin-bottom: 10px;
    }

    .legend-box {
        display: inline-block;
        height: 13px;
        width: 13px;
        margin: 0 5px 0 15px;
    }

    #yadcf-filter--historical-sites-table-1-reset {
    	color: #ffffff;
    	font-weight: bold;
    	background: #8e1024;
    	padding: 11px;
    }

    /*.yadcf-filter {
    	width: 40%;
    }*/

    select {
    	width: 40%;
    }
    </style>
</head>

<body>
    <h3>Undesignated cultural and historical sites in Denver</h3>
    <p><em>Filter map and table using dropdown menus. Click map markers for details.</em></p>
    <div class="legend"><span class="legend-box" style="background:#fdbf6f;margin-left:0"></span>Arts<span class="legend-box" style="background:#e31a1c"></span>Chicano Movement or Crusade for Justice<span class="legend-box" style="background:#fb9a99"></span>Commercial<span class="legend-box" style="background:#33a02c"></span>Educational<span class="legend-box" style="background:#b2df8a"></span>Labor-related<span class="legend-box" style="background:#000000"></span>Neighborhood<span class="legend-box" style="background:#1f78b4"></span>Political<span class="legend-box" style="background:#a6cee3"></span>Religious</div>
    <div id="wrapper">
        <div id="panel"><span class="p2"></span>
            <select id="category" onchange="categorySelect()">
                <option value="">Filter by category</option>
                <option value="Arts">Arts</option>
                <option value="Chicano Movement or Crusade for Justice">Chicano Movement or Crusade for Justice</option>
                <option value="Commercial">Commercial</option>
                <option value="Educational">Educational</option>
                <option value="Labor-related">Labor-related</option>
                <option value="Neighborhood">Neighborhood</option>
                <option value="Political">Political</option>
                <option value="Religious">Religious</option>
            </select>
        </div>
        <div id="map"> </div>
        <hr>
        <div class="reset" id="filter-1"></div>
        <table id="historical-sites-table" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th>Site</th>
                    <th>Category</th>
                    <th>Address</th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <script>
    var url = 'historical_sites.json';

    var map = L.map('map').setView([39.7391536, -104.9847034], 12);

    var mapTiles = new L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        subdomains: 'abcd',
        maxZoom: 20,
        minZoom: 11
    });
    mapTiles.addTo(map);

    // Categories: Arts, Chicano Movement or Crusade for Justice, Commercial, Educational, Labor-related, Neighborhood, Political, Religious
    // ['#a6cee3','#1f78b4','#b2df8a','#33a02c','#fb9a99','#e31a1c','#fdbf6f']

    const artsIcon = L.divIcon({
        html: '<i class="fa-solid fa-location-dot" style="color:#fdbf6f"></i>',
        className: 'map-icon'
    });
    const chicanoMovementIcon = L.divIcon({
        html: '<i class="fa-solid fa-location-dot" style="color:#e31a1c"></i>',
        className: 'map-icon'
    });
    const commercialIcon = L.divIcon({
        html: '<i class="fa-solid fa-location-dot" style="color:#fb9a99"></i>',
        className: 'map-icon'
    });
    const educationalIcon = L.divIcon({
        html: '<i class="fa-solid fa-location-dot" style="color:#33a02c"></i>',
        className: 'map-icon'
    });
    const laborRelatedIcon = L.divIcon({
        html: '<i class="fa-solid fa-location-dot" style="color:#b2df8a"></i>',
        className: 'map-icon'
    });
    const neighborhoodIcon = L.divIcon({
        html: '<i class="fa-solid fa-location-dot" style="color:#000000"></i>',
        className: 'map-icon'
    });
    const politicalIcon = L.divIcon({
        html: '<i class="fa-solid fa-location-dot" style="color:#1f78b4"></i>',
        className: 'map-icon'
    });
    const religiousIcon = L.divIcon({
        html: '<i class="fa-solid fa-location-dot" style="color:#a6cee3"></i>',
        className: 'map-icon'
    });


    var myData = L.layerGroup([]);

    var historicalSites = L.geoJSON(null, {
        pointToLayer: function(feature, latlng) {

            var popupText = '<h3 class="category">' + feature.properties.Category + '</h3><p class="site">' + feature.properties.Site + '</p><p class="address">' + feature.properties.Address + '</p>';

            var initialIconType;
            if (feature.properties.Category === 'Arts') {
                initialIconType = artsIcon
            } else if (feature.properties.Category === 'Chicano Movement or Crusade for Justice') {
                initialIconType = chicanoMovementIcon
            } else if (feature.properties.Category === 'Commercial') {
                initialIconType = commercialIcon
            } else if (feature.properties.Category === 'Educational') {
                initialIconType = educationalIcon
            } else if (feature.properties.Category === 'Labor-related') {
                initialIconType = laborRelatedIcon
            } else if (feature.properties.Category === 'Neighborhood') {
                initialIconType = neighborhoodIcon
            } else if (feature.properties.Category === 'Political') {
                initialIconType = politicalIcon
            } else if (feature.properties.Category === 'Religious') {
                initialIconType = religiousIcon
            }
            return L.marker(latlng, {
                icon: initialIconType
            }).bindPopup(popupText);
        }
    });

    $.getJSON(url, function(data) {
        historicalSites.addData(data);
    });

    myData.addLayer(historicalSites);
    myData.addTo(map);
    function categorySelect() {
        var choice = document.getElementById("category").value;

        var iconType;

        switch (choice) {
            case 'Arts':
                iconType = artsIcon
                break;
            case 'Chicano Movement or Crusade for Justice':
                iconType = chicanoMovementIcon
                break;
            case 'Commercial':
                iconType = commercialIcon
                break;
            case 'Educational':
                iconType = educationalIcon
                break;
            case 'Labor-related':
                iconType = laborRelatedIcon
                break;
            case 'Neighborhood':
                iconType = neighborhoodIcon
                break;
            case 'Political':
                iconType = politicalIcon
                break;
            case 'Religious':
                iconType = religiousIcon
                break;
            // default:
            //     iconType = commercialIcon
        }

        myData.clearLayers();
        map.removeLayer(myData);

        historicalSites = L.geoJSON(null, {
            pointToLayer: function(feature, latlng) {

                var popupText = '<h3 class="category">' + feature.properties.Category + '</h3><p class="site">' + feature.properties.Site + '</p><p class="address">' + feature.properties.Address + '</p>';
                return L.marker(latlng, {
                    icon: iconType
                }).bindPopup(popupText);
            },
            filter: function(feature, layer) {
                return (feature.properties.Category == choice);
            },

        });

        $.getJSON(url, function(data) {
            historicalSites.addData(data);
        });

        myData.addLayer(historicalSites);
        myData.addTo(map);
    };

    var dataFile = 'historical_sites.js';

    function disableDependentFilter(level, inuse) {
        if (level < 4) {
            filter = $('#yadcf-filter--example-' + level);
            yadcf.exResetFilters(metroDistrictsTable, [level]);
            filter.prop('disabled', !inuse);

            disableDependentFilter(level + 1, false);
        }
    }
    // Site	Area	Address	Additional Notes	Category		address_for_geocoding	Latitude	Longitude
    var metroDistrictsTable = $('#historical-sites-table').DataTable({
        ajax: {
            'url': dataFile,
            'dataSrc': ''
        },
        // pageLength: 15,
        scrollY: '1000px',
        //scrollCollapse: true,
        scrollX: true,
        paging: false,
        pageLength: null,
        fixedHeader: true,
        // responsive: {
        //     details: {
        //         type: 'column'
        //     }
        // },
        //dom: '<if<t>lp>',
        order: [
            [0, 'asc']
        ],
        columns: [
            //{ data: 'button' },
            {
                data: 'Site'
                // render: function(data,type,row) {
                //  return '<a href="' + row.dola_link + '" target="_blank">' + data + '</a>'
                // }
            },
            {
                data: 'Category'
            },
            {
                data: 'Address'
            },
            { data: 'Area', visible: false },
            { data: 'Additional Notes', visible: false },
            { data: 'address_for_geocoding', visible: false },
            { data: 'Latitude', visible: false },
            { data: 'Longitude', visible: false },
        ],

        initComplete: function() {
            yadcf.init(metroDistrictsTable, [{
                column_number: 1,
                filter_container_id: 'filter-1',
                filter_default_label: 'Filter by category',
                //data: donorTypes
            }, ], {
                //cumulative_filtering: true,
                filter_reset_button_text: 'Reset filter'
            });

            disableDependentFilter(1, true);

            $('.yadcf-filter-reset-button').on('click', function() {
                level = parseInt(this.id.split('-')[1]);
                disableDependentFilter(level, true);
            });

            $('.yadcf-filter').on('change', function() {
                level = parseInt(this.id.slice(-1));
                inuse = $(this).hasClass('inuse');

                disableDependentFilter(level + 1, inuse);
            });
        }
    });
    </script>
</body>

</html>