<html>

<head>
    <title>Officer-involved Shootings | The Denver Post</title>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.3.5/tabletop.min.js"></script>
    <style>
    @import url('https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed|Roboto+Mono');

    body {
        font-family: 'Roboto', sans-serif;
    }

    #map {
        width: 100%;
        height: 500px;
    }

    h3 {
        font-family: 'Roboto', monospace;
        font-size: 1.5em;
        font-weight: 100;
        margin-bottom: 12px;
    }

    .popup-text {
        margin-bottom: -14px !important;
        font-family: 'Roboto', monospace;
        font-size: 1.2em;
    }

    .legend-text {
        font-weight: 700;
    }

    .leaflet-popup-content {
        max-width: 250px;
    }

    .leaflet-popup-content-wrapper {
        border-radius: 0;
        background-color: #fafafa;
    }
    </style>
</head>

<body>
    <p>There have been <span id="incident-count"></span> officer-involved shootings in Colorado in 2019. The last incident occurred on <span id="last-date"></span> in <span id="last-city"></span>.</p>
    <p><em>Zoom the map and click markers for details</em>
        <p class="legend-text"><span style="border-top:4px solid #000">Injured</span> &bull; <span style="border-top:4px solid red">Killed</span></p>
        <div id="map"></div>
        <script>
        var map;
        var code = "13hPoaY5et0sYWvsqH3fcuBQUsMbflDJziRxatgWLyX8";
        //https://docs.google.com/spreadsheets/d/13hPoaY5et0sYWvsqH3fcuBQUsMbflDJziRxatgWLyX8/edit#gid=0

        var unknownIcon = new L.Icon({
            iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        var killedIcon = new L.Icon({
            iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        var injuredIcon = new L.Icon({
            iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-black.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        var iconColor;

        document.addEventListener('DOMContentLoaded', function() {
            map = L.map('map').setView([39.0501, -105.3821], 7);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);

            Tabletop.init({
                key: code,
                callback: function(sheet, tabletop) {
                	var incidentCount = sheet.length;
                	var lastDate = sheet[(incidentCount - 1)].date;
                	var lastCity = sheet[(incidentCount - 1)].city;
                	document.getElementById('incident-count').innerHTML = incidentCount;
                	document.getElementById('last-date').innerHTML = lastDate;
                	document.getElementById('last-city').innerHTML = lastCity;

                    for (var i in sheet) {
                        var place = sheet[i];
                        if (place.victimstatus == 'Injured') {
                            iconColor = injuredIcon
                        } else if (place.victimstatus == 'Killed') {
                            iconColor = killedIcon
                        } else {
                            iconColor = unknownIcon
                        }
                        L.marker([place.latitude, place.longitude], { icon: iconColor })
                            .addTo(map)
                            .bindPopup('<h3>' + place.city + ' &bull; ' + place.date + '</h3><hr><p class="popup-text" style="margin-top:5px;"><strong>Agency: </strong>' + place.agency + '</p><p class="popup-text" ><strong>Location: </strong>' + place.address + '</p><p  class="popup-text" style="text-align:center;">&bull; &bull; &bull;</p><p class="popup-text" >' + place.description + '</p><p class="popup-text" style="margin-bottom: 8px !important;text-align:right;"><a href="' + place.storylink + '" target="_blank">Read the story</a></p>')
                    }
                },
                simpleSheet: true
            })
        })
        </script>
</body>

</html>