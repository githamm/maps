<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="robots" content="noindex,follow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asthma in Denver | The Denver Post</title>
    <link rel="shortcut icon" href="https://extras.mnginteractive.com/live/media/favIcon/dpo/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/foundation/6.2.4/foundation.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin="" />
    <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/foundation/6.2.4/foundation.min.js"></script>
    <script src="https://extras.denverpost.com/foundation/js/vendor/modernizr.js"></script>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
    <script src="https://extras.denverpost.com/app/homicide-report/js/leaflet-grouped-layer-control.js"></script>
    <style>
    @import url('https://fonts.googleapis.com/css?family=Roboto');

    html,
    body {
        height: 100%;
        width: 100%;
        padding: 0;
        background-color: #fafafa;
        font-family: 'Roboto', sans-serif;
        margin-top: 1%;
    }

    #map {
        height: 500px;
    }
    </style>
</head>

<body>
    <div id="map"></div>
    <script>
    var map = L.map("map").setView([49.568106423004863, 2.753862487322691], 14);

    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    var oise = {
        "type": "FeatureCollection",
        "crs": {
            "type": "name",
            "properties": {
                "name": "urn:ogc:def:crs:OGC:1.3:CRS84"
            }
        },
        "features": [{
            "type": "Feature",
            "properties": {
                "DEPCOM": "60538",
                "NOM_COM": "Ricquebourg",
                "IRIS": "0000",
                "DCOMIRIS": "605380000",
                "NOM_IRIS": "Ricquebourg",
                "TYP_IRIS": "Z"
            },
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [2.753862487322691, 49.568106423004863],
                        [2.754834569610532, 49.567467723103867],
                        [2.755374727888817, 49.567112846570275],
                        [2.75585282747064, 49.566527871018629],
                        [2.755916398961054, 49.56594385787055],
                        [2.755844137158009, 49.565449439131314],
                        [2.755354284133803, 49.564733104021172],
                        [2.756729896258653, 49.564817378618457],
                        [2.758105512897535, 49.564901637620451],
                        [2.753862487322691, 49.568106423004863]
                    ]
                ]
            }
        }]
    };

    /*
    DCOMIRIS;score
    600010000;0.025
    600020000;0.03333333333333333
    */
    var results = {
        data: [{
            DCOMIRIS: "600010000",
            score: "0.025"
        }, {
            DCOMIRIS: "600020000",
            score: "0.03333333333333333"
        }, {
            DCOMIRIS: "605380000", // need the correct code
            score: "0.3"
        }]
    };

    function complete(results) { //everything below runs only after the CSV has been loaded and processed.

        function getColor(d) {
            return d > 0.5 ? '#800026' :
                d > 0.4 ? '#BD0026' :
                d > 0.3 ? '#E31A1C' :
                d > 0.25 ? '#FC4E2A' :
                d > 0.2 ? '#FD8D3C' :
                d > 0.15 ? '#FEB24C' :
                d > 0.1 ? '#FED976' :
                '#FFEDA0';
        }

        // map the DCOMIRIS first, so that we can retrieve them by DCOMIRIS easily.
        var DCOMIRIS = {},
            data = results.data;

        for (var i = 0; i < data.length; i += 1) {
            DCOMIRIS[data[i].DCOMIRIS] = data[i].score;
        }


        var oiseLayer = new L.geoJson(oise, {
            style: function(feature) {
                // var filtered = results.data.filter(function(data){return data.DCOMIRIS == this;}, feature.properties.DCOMIRIS.toString());

                return {
                    weight: 5,
                    opacity: 1,
                    color: 'black',
                    fillOpacity: 0.7,
                    fillColor: getColor(parseFloat(DCOMIRIS[feature.properties.DCOMIRIS]))
                };
            }
        }).addTo(map);
    }

    complete(results);

    //L.geoJson(oise).addTo(map);
    </script>
</body>

</html>